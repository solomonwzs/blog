---
title: Fenwick Tree
date: 2017-09-16
tags:
- algorithm
categories:
- algorithm
---

binary indexed tree，树状数组，能在 $$log(n)$$ 时间内查询区间和，以及更新结点。

<!-- more -->

## 结构

```
16 (5)  .............................................................O
 8 (4)  .............................O                               |
 4 (3)  .............O               |  .............O               |
 2 (2)  .....O       |  .....O       |  .....O       |  .....O       |
 1 (1)  .O   |  .O   |  .O   |  .O   |  .O   |  .O   |  .O   |  .O   |
        01  02  03  04  05  06  07  08  09  10  11  12  13  14  15  16
```

节点的高度 $$H_{i}$$ 为 $$i$$ 的二进制表达式最右边的1对应的值，如12的二进制为1100，高度 $$H_{i}$$ 为4

计算方法为：$$H_{i}=i$$ & $$-i$$（$$-i$$ 在计算机中的二进制表达式为 $$i$$ 的各位取反后加1）。

对于节点 $$i$$，

- $$i$$ 往右边的父（祖父）节点为 $$i+H_{i}$$，ex：6(0110) -> 8(1000)
- $$i$$ 往左边的父（祖父）节点为 $$i-H_{i}$$，ex：6(0110) -> 4(0100)

定义：

- $$N_{i}$$ 为节点 $$i$$ 的值
- $$C_{i}$$ 为节点 $$i$$ 及其左子树所有节点的值之和，也就是长条内所覆盖的节点的值之和
- $$S_{i}$$ 为区间 $$[1..i]$$ 之和

所以：

- $$S_{i}$$ 为由节点 $$i$$ 开始，边往左边向上爬，途径所有节点的值之和
- 当修改了 $$N_{i}$$ 的值，则边往右边往上爬，修改途径的所有节点对应的 $$C$$ 的值


## 实现代码

### Python

```python
class FenwickTree(object):
    def __init__(self, n):
        self.c = [0] * (n + 1)
        self.n = n

    def __height(self, i):
        return i & -i

    def add(self, i, value):
        while i <= self.n:
            self.c[i] += value
            i += self.__height(i)

    def sum(self, i):
        res = 0
        while i > 0:
            res += self.c[i]
            i -= self.__height(i)
        return res
```
