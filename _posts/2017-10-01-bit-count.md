---
title: Bit Count
date: 2017-10-01
tags:
- algorithm
categories:
- algorithm
---

计算一个整数的二进制中1的个数

<!-- more -->

## 逐位计算

复杂度 $$ log(N) $$，$$N$$ 为整数二进制长度

``` python
def bitCount0(n:int) -> int:
    c = 0
    while n > 0:
        if n & 1 == 1:
            c += 1
        n >>= 1
    return c
```

## 快速计算

复杂度 $$ log(N) $$，$$N$$ 为整数二进制中1的个数

``` python
def bitCount1(n:int) -> int:
    c = 0
    while n > 0:
        c += 1
        n &= (n - 1)
    return c
```

每次执行 `n &= (n - 1)`，都会将 `n` 最右边的1变为0

## 查表

每次取 `n` 位，通过查表，查出这 `n` 位中 1 的个数

## 邻位合并

``` python
def bitCount2(n:int) -> int:
    n = (n & 0x55555555) + ((n >> 1)  & 0x55555555)
    n = (n & 0x33333333) + ((n >> 2)  & 0x33333333)
    n = (n & 0x0f0f0f0f) + ((n >> 4)  & 0x0f0f0f0f)
    n = (n & 0x00ff00ff) + ((n >> 8)  & 0x00ff00ff)
    n = (n & 0x0000ffff) + ((n >> 16) & 0x0000ffff)
    return n
```

ex: $$ 217_{10} = 11011001_2 $$
```
1 1 0 1 1 0 0 1
\ / \ / \ / \ /
 2   1   1   1
(10)(01)(01)(01)
 \   /   \   /
   3       2
 (0011)  (0010)
   \       /
       5
```

## 移位合并

``` python
def bitCount3(n:int) -> int:
    tmp = n - ((n >> 1) & 0o33333333333) - ((n >> 2) & 0o11111111111)
    return ((tmp + (tmp >> 3)) & 0o30707070707) % 63
```

ex:

row 1：二进制 3 bits 一组，每组可表示为：$$ 2^2*a+2^1*b+2^0*c $$，通过移位计算出 $$ a+b+c $$，即这一组1的个数

```python
n
```

$$ 345_{10} = 101,011,001_2 $$

$$ 3 bits: 2^2*a+2^1*b+2^0*c $$

```python
((n >> 1) & 0o33333333333)
```

$$ 010,001,000_2 $$

$$ 3 bits: 2^1*a+2^0*b $$

```python
((n >> 2) & 0o11111111111)
```

$$ 001,000,000_2 $$

$$ 3 bits: 2^0*a $$

```python
n - ((n >> 1) & 0o33333333333) - ((n >> 2) & 0o11111111111)
```

$$ 2^2*a+2^1*b+2^0*c - (2^1*a+2^0*b) - (2^0*a) = a + b + c $$

row 2：二进制 6 bits 一组，通过移位计算出这一组中1的个数，通过取余63，将各组的个数加起来

$$ tmp = 145 $$

$$ 145_{10} = 000,010,010,001_2 $$

```python
(tmp + (tmp >> 3)) & 0o30707070707
```

$$ 000,010,010,001_2 $$

$$ 000,000,010,010_2 $$

$$ 000,010,000,011_2 $$

```python
tmp % 63
```

对于任意一组 6 bits 的数，可表示为：$$ m * (2^6)^n = m * 64^n $$，由于 $$m$$ 等于 6 bits 组里1的个数，所以 $$ m \le 6 $$，所以

$$ m * 64^n \mod 63 = m * (64^n \mod 63) \mod 63 = m \mod 63 = m $$

$$ 000,010,000,011_2 \Rightarrow 000,010_2 + 000,011_2 $$
